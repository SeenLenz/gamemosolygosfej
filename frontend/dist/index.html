<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Document</title>
        <link rel="stylesheet" href="style.css" />
    </head>
    <body>
        <button id="msg_bt">Send Msg</button>
        <input type="text" name="lobby" id="join_label">
        <button id="join_bt">Join Lobby</button>
        <button id="create_bt">create Lobby</button>
        <canvas id="main_canvas">
        </canvas>
    </body>
    <script src="./networking.js" type="module"></script>
    <script src="index.js" type="module"></script>
    <script type="x-shader/x-vertex" id="vertex_shader">#version 300 es
        in vec2 a_pos;
        in vec2 texture_coord;
        uniform vec2 u_res;

        uniform vec2 u_screen_position;
        uniform vec2 u_scale;
        uniform vec2 u_rotation;
        uniform int u_flip;

        uniform vec3 camera;
        uniform vec2 camera_rot;

        out vec2 v_texture_coords;
        void main() {
            vec2 new_pos = a_pos - vec2(0.5, 0.5);
            new_pos = vec2(new_pos.x * u_rotation.y + new_pos.y * u_rotation.x, new_pos.y * u_rotation.y - new_pos.x * u_rotation.x);
            new_pos += vec2(0.5, 0.5);

            vec2 camera_pos = vec2(camera.x * camera_rot.y + camera.y * camera_rot.x, camera.y * camera_rot.y - camera.x * camera_rot.x);

            //calculate the transformations
            vec2 screen_pos = new_pos * u_scale + u_screen_position;
            screen_pos -= camera.xy + vec2(1, 1) / 2. * u_res;
            screen_pos = vec2(screen_pos.x * camera_rot.y + screen_pos.y * camera_rot.x, screen_pos.y * camera_rot.y - screen_pos.x * camera_rot.x);
            screen_pos += vec2(1, 1) / 2. * u_res;
            
            // convert to clip space
            screen_pos = (screen_pos / u_res * 2. - vec2(1, 1)) * vec2(camera.z, camera.z);
            
            // flip y axis to match with js
            screen_pos *= vec2(1, -1);
            
            gl_Position = vec4(screen_pos, 0, 1);
            vec2 text_coord = vec2(texture_coord.x, texture_coord.y);
            v_texture_coords = text_coord;
        }
    </script>
    <script type="x-shader/x-fragment" id="fragment_shader">#version 300 es
        precision mediump float;

        in vec2 v_texture_coords;
        out vec4 fragColor;

        uniform sampler2D u_sampler;

        void main() {
            fragColor = texture(u_sampler, v_texture_coords);
        }
    </script>
</html>
